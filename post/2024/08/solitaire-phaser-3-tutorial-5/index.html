<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Solitaire HTML5 Game Tutorial With Phaser 3 Part 5: Core Solitaire Logic - Scott Westover</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Solitaire HTML5 Game Tutorial With Phaser 3 Part 5: Core Solitaire Logic"><meta property="og:description" content="In this tutorial series, we’ll be looking at how to recreate the game Solitaire using the Phaser 3 framework. Here’s an example of what the final game should look like:
Previously, in part 4 , we focused on adding support for moving cards between the various card piles in our game, and we started to stub out the Solitaire class that will have the core logic for our Solitaire game."><meta property="og:type" content="article"><meta property="og:url" content="https://scottwestover.dev/post/2024/08/solitaire-phaser-3-tutorial-5/"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-08-30T08:00:02+00:00"><meta property="article:modified_time" content="2024-08-30T08:00:02+00:00"><meta itemprop=name content="Solitaire HTML5 Game Tutorial With Phaser 3 Part 5: Core Solitaire Logic"><meta itemprop=description content="In this tutorial series, we’ll be looking at how to recreate the game Solitaire using the Phaser 3 framework. Here’s an example of what the final game should look like:
Previously, in part 4 , we focused on adding support for moving cards between the various card piles in our game, and we started to stub out the Solitaire class that will have the core logic for our Solitaire game."><meta itemprop=datePublished content="2024-08-30T08:00:02+00:00"><meta itemprop=dateModified content="2024-08-30T08:00:02+00:00"><meta itemprop=wordCount content="6229"><meta itemprop=keywords content="HTML5,Game Development,TypeScript,Tutorial,Solitaire,PhaserJS,Phaser3,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Solitaire HTML5 Game Tutorial With Phaser 3 Part 5: Core Solitaire Logic"><meta name=twitter:description content="In this tutorial series, we’ll be looking at how to recreate the game Solitaire using the Phaser 3 framework. Here’s an example of what the final game should look like:
Previously, in part 4 , we focused on adding support for moving cards between the various card piles in our game, and we started to stub out the Solitaire class that will have the core logic for our Solitaire game."><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Scott Westover" rel=home><div class="logo__item logo__text"><div class=logo__title>Scott Westover</div><div class=logo__tagline>A Developer's Blog</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/courses/><span class=menu__text>Courses</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About Me</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Solitaire HTML5 Game Tutorial With Phaser 3 Part 5: Core Solitaire Logic</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2024-08-30T08:00:02Z>August 30, 2024</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/html5/ rel=category>HTML5</a>, <a class=meta__link href=/categories/game-development/ rel=category>Game Development</a>, <a class=meta__link href=/categories/typescript/ rel=category>TypeScript</a>, <a class=meta__link href=/categories/tutorial/ rel=category>Tutorial</a>, <a class=meta__link href=/categories/solitaire/ rel=category>Solitaire</a>, <a class=meta__link href=/categories/phaserjs/ rel=category>PhaserJS</a>, <a class=meta__link href=/categories/phaser3/ rel=category>Phaser3</a></span></div></div></header><figure class="post__thumbnail thumbnail"><img class=thumbnail__image src=/post/2024/08/solitaire-phaser-3-tutorial-5/images/solitaire-phaser-3-tutorial-5-thumbnail.png alt="Solitaire HTML5 Game Tutorial With Phaser 3 Part 5: Core Solitaire Logic"></figure><div class="content post__content clearfix"><p>In this tutorial series, we’ll be looking at how to recreate the game Solitaire using the Phaser 3 framework. Here’s an example of what the final game should look like:</p><img src=/img/phaser-3-solitaire-tutorial/gameplay.gif alt="Phaser Solitaire Gameplay" style=margin-bottom:10px><p>Previously, in
<a href=/post/2024/08/solitaire-phaser-3-tutorial-4/>part 4</a>
, we focused on adding support for moving cards between the various card piles in our game, and we started to stub out the <code>Solitaire</code> class that will have the core logic for our Solitaire game.</p><p>In part 5 of this series, we are going to start working on building out the <code>Solitaire</code> class and adding the actual logic for our game. We will then work on connecting this logic to our Phaser game instance.</p><h2 id=deck-of-cards>Deck Of Cards</h2><p>To get us started with building out the core game logic for our Solitaire game, the first thing we will handle is creating types and data models to represent our deck of cards. In the game of Solitaire, we use a standard deck of 52 cards, which has the following attributes:</p><ul><li>There are two card colors: red and black.</li><li>There are four card suites: spades, clubs, diamonds, and hearts.</li><li>All cards that are in the hearts or diamonds suits, will be the color red.</li><li>All cards that are in the spades or clubs suits, will be the color black.</li><li>Each suit will have 13 cards, the ace, the numbers 2 through 10, a jack, a queen, and a king.<ul><li>To make it easier to work with the various cards, we will assign each card a value, and we will represent the card as a number 1 through 13.</li><li>The ace will be 1, numbers 2 through 10 will be numbers 2 through 10, the jack is 11, queen is 12, and king is 13.</li></ul></li><li>Each card in the game will be in one of two states, either face up or face down.<ul><li>When the card is face down, we will show the player the card back frame, and the player cannot drag these cards.</li><li>When the card is face up, we will show the player the correct card frame and the player can drag these cards if it is not in the foundation pile.</li></ul></li></ul><p>To get started with modeling the deck of cards in our code, the first thing we will do is create a new file to contain all of the common code for our deck of cards. In the <code>src/lib</code> folder create a new file called <code>common.ts</code>, and add the following code to the file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CardSuit</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>keyof</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>CARD_SUIT</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CARD_SUIT</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>HEART</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;HEART&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>DIAMOND</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;DIAMOND&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>SPADE</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;SPADE&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>CLUB</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;CLUB&#39;</span>,
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>const</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CardValue</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>6</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>9</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>11</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>12</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>13</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CardSuitColor</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>keyof</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>CARD_SUIT_COLOR</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CARD_SUIT_COLOR</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>RED</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;RED&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>BLACK</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;BLACK&#39;</span>,
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>const</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CARD_SUIT_TO_COLOR</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>CARD_SUIT</span>.<span style=color:#a6e22e>CLUB</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>CARD_SUIT_COLOR</span>.<span style=color:#a6e22e>BLACK</span>,
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>CARD_SUIT</span>.<span style=color:#a6e22e>SPADE</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>CARD_SUIT_COLOR</span>.<span style=color:#a6e22e>BLACK</span>,
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>CARD_SUIT</span>.<span style=color:#a6e22e>DIAMOND</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>CARD_SUIT_COLOR</span>.<span style=color:#a6e22e>RED</span>,
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>CARD_SUIT</span>.<span style=color:#a6e22e>HEART</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>CARD_SUIT_COLOR</span>.<span style=color:#a6e22e>RED</span>,
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>const</span>;
</span></span></code></pre></div><p>In the code above, we create new variables and types to represent the attributes of our deck of cards. Next, we will create a class to represent the Card object in our deck of cards. To do this, create a new file in the <code>src/lib</code> folder called <code>card.ts</code>, and add the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>CARD_SUIT_TO_COLOR</span>, <span style=color:#a6e22e>CardSuit</span>, <span style=color:#a6e22e>CardSuitColor</span>, <span style=color:#a6e22e>CardValue</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./common&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Card</span> {
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>suit</span>: <span style=color:#66d9ef>CardSuit</span>;
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>CardValue</span>;
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>faceUp</span>: <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>suit</span>: <span style=color:#66d9ef>CardSuit</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>CardValue</span>, <span style=color:#a6e22e>isFaceUp</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>suit</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>suit</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>faceUp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>isFaceUp</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>suit</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>CardSuit</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>suit</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>value</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>CardValue</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>isFaceUp</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>faceUp</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>color</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>CardSuitColor</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CARD_SUIT_TO_COLOR</span>[<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>suit</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>flip</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>faceUp</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>faceUp</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For the <code>Card</code> class, we added three properties to keep track of the suit, the value of the card, and if the card is face up or not. Besides this, we added a few getters to get these properties, and one special getter to get the cards color based on the suit of the card. Finally, we added a public method to flip the card over.</p><p>Now that we have defined the object to represent our cards, the next thing we need to do is create a class to represent the full deck of cards. For our deck of cards, we will need the following functionality:</p><ul><li>Ability to construct a deck with 52 unique cards (13 cards in each suit).</li><li>Have a discard and draw pile.</li><li>Ability to draw a card from the draw pile.</li><li>Have ability to shuffle the deck of cards, and to re-add the cards from the discard pile back into our draw pile.</li></ul><p>So, in order to create this functionality, we need to create a new file under the <code>src/lib</code> folder called <code>deck.ts</code>, and in this file place the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Card</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./card&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>CARD_SUIT</span>, <span style=color:#a6e22e>CardValue</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./common&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>shuffleArray</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./utils&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Deck</span> {
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>cards</span>: <span style=color:#66d9ef>Card</span>[];
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>drawPile</span>: <span style=color:#66d9ef>Card</span>[];
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPile</span>: <span style=color:#66d9ef>Card</span>[];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>cards</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>drawPile</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPile</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>createDeck</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>cards</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Card</span>[] {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>cards</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>drawPile</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Card</span>[] {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>drawPile</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>discardPile</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Card</span>[] {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPile</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>draw</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Card</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>undefined</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>drawPile</span>.<span style=color:#a6e22e>shift</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>shuffle</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shuffleArray</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>drawPile</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>shuffleInDiscardPile</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPile</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>card</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>flip</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>drawPile</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>card</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPile</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>reset</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPile</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>drawPile</span> <span style=color:#f92672>=</span> [...<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>cards</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>shuffle</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>createDeck</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    Object.<span style=color:#a6e22e>values</span>(<span style=color:#a6e22e>CARD_SUIT</span>).<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>suit</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>14</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>cards</span>.<span style=color:#a6e22e>push</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Card</span>(<span style=color:#a6e22e>suit</span>, <span style=color:#a6e22e>i</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>CardValue</span>));
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the code above, we created a new class that has three private properties for tracking the cards in our deck. We then added getters to return the values of these properties, and we added in public methods to allow us to: draw cards, shuffle the deck, and to re-shuffle back in the discard cards back into the draw pile. For the <code>shuffleInDiscardPile</code> method, one of the things in Solitaire is when you add the discard pile of cards back into the draw pile, you don&rsquo;t actually shuffle the cards, instead you just flip the card pile over and start drawing cards again. To recreate this, we just loop through pile of cards and add those cards in that order to the draw pile array. This is because when we draw cards, we are taking them from end of the array. Finally, in the <code>#createDeck</code> method, to create the deck of cards, we are looping through each of our card suits, and for each of these we are looping through the values of 1 through 13, and creating a card instance for each of these.</p><p>For the <code>shuffle</code> method, this is referring to a utility function that we have not created yet. To shuffle the cards, we will use a common algorithm called
<a href=https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle target=_blank rel=noopener>Fisher Yates Shuffle</a>
, which is an in place shuffle algorithm. At a high level, we loop through the array we want to shuffle in reverse, and then choose a random index to switch elements in the array around. To create this function, create a new file in the <code>src/lib</code> folder called <code>utils.ts</code> and add the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>shuffleArray</span>&lt;<span style=color:#f92672>T</span>&gt;(<span style=color:#a6e22e>array</span>: <span style=color:#66d9ef>T</span>[])<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>array</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>temp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>array</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>array</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>array</span>[<span style=color:#a6e22e>j</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>array</span>[<span style=color:#a6e22e>j</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>temp</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Utility function to ensure we handle the full possible range of types when checking a variable for a possible
</span></span></span><span style=display:flex><span><span style=color:#75715e> * type in a union.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * A good example of this is when we check for all of the possible values in a `switch` statement, and we want
</span></span></span><span style=display:flex><span><span style=color:#75715e> * to ensure we check for all possible values in an enum type object.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>exhaustiveGuard</span>(<span style=color:#a6e22e>_value</span>: <span style=color:#66d9ef>never</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>never</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Error! Reached forbidden guard function with unexpected value: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>_value</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the code above, we also introduced a new utility function called <code>exhaustiveGuard</code>. This function has not been used yet, and will be used in our <code>Solitaire</code> class. This is a special function that can be used as a guard to make sure we handle the full range of options when checking a variable, and if we don&rsquo;t, our editor will warn us of the cases that we did not cover in our code. Once we get to this in our code, we will see an example of this, and for the time being we can ignore this function.</p><p>So one last thing we are going to do before we jump into our <code>Solitaire</code> class, is we are going to create a class to model one of our foundation piles. For the foundation piles, we will need to be able to support the following functionality:</p><ul><li>Have properties to keep track of the card suit that goes on that pile, and the current value of the pile.</li><li>Have methods to reset the initial value of the foundation pile, and to add a new card to the foundation pile.</li></ul><p>To do this, create a new file in the <code>src/lib</code> folder called <code>foundation-pile.ts</code>, and add the following code to the file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>CardSuit</span>, <span style=color:#a6e22e>CardValue</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./common&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FoundationPile</span> {
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>suit</span>: <span style=color:#66d9ef>CardSuit</span>;
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>currentValue</span>: <span style=color:#66d9ef>CardValue</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#a6e22e>suit</span>: <span style=color:#66d9ef>CardSuit</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>suit</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>suit</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>currentValue</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>suit</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>CardSuit</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>suit</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>value</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>CardValue</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>currentValue</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>addCard</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>currentValue</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>13</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>currentValue</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>reset</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>currentValue</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>With the <code>FoundationPile</code> class created, that wraps up the classes and models we need to represent our deck of cards and other types needed for the game of Solitaire. So with these finished, we can now switch to working on adding the core logic we need in our <code>Solitaire</code> class.</p><h2 id=core-solitaire-logic>Core Solitaire Logic</h2><p>For the game of Solitaire, we will need to add support for the following: the deck of cards, draw pile, discard pile, the four foundation piles, and the seven tableau piles. For these properties, we will need to be able to retrieve the details of them from our <code>GameScene</code> class, that way we can have our Phaser Game state match the actual Solitaire game state. To do all of this, open the <code>Solitaire</code> class and add the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>: <span style=color:#66d9ef>Deck</span>;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileSpade</span>: <span style=color:#66d9ef>FoundationPile</span>;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileClub</span>: <span style=color:#66d9ef>FoundationPile</span>;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileHeart</span>: <span style=color:#66d9ef>FoundationPile</span>;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileDiamond</span>: <span style=color:#66d9ef>FoundationPile</span>;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span>: <span style=color:#66d9ef>Card</span>[][];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>constructor</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Deck</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileClub</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FoundationPile</span>(<span style=color:#a6e22e>CARD_SUIT</span>.<span style=color:#a6e22e>CLUB</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileSpade</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FoundationPile</span>(<span style=color:#a6e22e>CARD_SUIT</span>.<span style=color:#a6e22e>SPADE</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileHeart</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FoundationPile</span>(<span style=color:#a6e22e>CARD_SUIT</span>.<span style=color:#a6e22e>HEART</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileDiamond</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FoundationPile</span>(<span style=color:#a6e22e>CARD_SUIT</span>.<span style=color:#a6e22e>DIAMOND</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span> <span style=color:#f92672>=</span> [[], [], [], [], [], [], []];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>get</span> <span style=color:#a6e22e>drawPile</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Card</span>[] {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>drawPile</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>get</span> <span style=color:#a6e22e>discardPile</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Card</span>[] {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>discardPile</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>get</span> <span style=color:#a6e22e>tableauPiles</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>Card</span>[][] {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>get</span> <span style=color:#a6e22e>foundationPiles</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>FoundationPile</span>[] {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileSpade</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileClub</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileHeart</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileDiamond</span>,
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>get</span> <span style=color:#a6e22e>wonGame</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileClub</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>13</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileDiamond</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>13</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileHeart</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>13</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileSpade</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>13</span>
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Next, add the following <code>import</code> statements to the top of our <code>Solitaire</code> class file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Card</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./card&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>CARD_SUIT</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./common&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Deck</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./deck&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>FoundationPile</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./foundation-pile&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>exhaustiveGuard</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./utils&#39;</span>;
</span></span></code></pre></div><p>In the code above, we created new private properties to track our various card piles in our game, and in our <code>constructor</code>, we created new instances of our <code>Deck</code> and <code>FoundationPile</code> classes. For the foundation piles, we created an instance of the <code>FoundationPile</code> class for each card suit, and for the tableau piles, this will be a 2D array that will contain <code>Card</code> instances. We then created getters to return these private properties, and we created two custom getters: <code>foundationPiles</code> and <code>wonGame</code>. The <code>foundationPiles</code> getter will return an array of all of our foundation piles, and the <code>wonGame</code> getter will return a boolean value if we have managed to add all of the cards to the foundation piles.</p><h3 id=new-game-logic>New Game Logic</h3><p>With the basic structure of our <code>Solitaire</code> class in place, we can now start working on building the actual logic for our class. To get started, we will focus on the <code>newGame</code> method. For the <code>newGame</code> method, this method will be responsible for setting up our card piles in our game. To do this, we will reset our game state so that all of our card piles are empty, and our deck of cards will be shuffled. Once we do this, we will need to deal out cards to our 7 tableau card piles to match how our tableau piles are laid out in the <code>GameScene</code> class (1st pile has 1 card, 2nd pile has 2 cards, 3rd pile has 3 cards, and so on until we have 7 piles).</p><p>To do this, update the <code>newGame</code> method to match the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Resets the solitaire game state and setups up the game state for a new game by building the tableau piles that are needed.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>newGame</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Rules for game setup:
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * To form the tableau, seven piles need to be created. Starting from left to right, place the first card face up to make the first pile,
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * deal one card face down for the next six piles. Starting again from left to right, place one card face up on the second pile and deal
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * one card face down on piles three through seven. Starting again from left to right, place one card face up on the third pile and deal
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * one card face down on piles four through seven. Continue this pattern until pile seven has one card facing up on top of a pile of six
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * cards facing down.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * The remaining cards form the stock (or “hand”) pile and are placed above the tableau.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * When starting out, the foundations and waste pile do not have any cards.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span> <span style=color:#f92672>=</span> [[], [], [], [], [], [], []];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileClub</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileDiamond</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileHeart</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileSpade</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>7</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>i</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>7</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>card</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>draw</span>() <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>Card</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>j</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>i</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>flip</span>();
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span>[<span style=color:#a6e22e>j</span>].<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>card</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>At this point, if we called the <code>newGame</code> method, our game state would look like the following:</p><ul><li>The draw pile would have 24 cards, and the discard pile would have 0 cards.</li><li>The foundation piles would have 0 cards.</li><li>The seven tableau piles would have 28 cards like so: [1, 2, 3, 4, 5, 6, 7].</li></ul><h3 id=draw-card-logic>Draw Card Logic</h3><p>For the <code>drawCard</code> method, when we draw a new card from the draw pile, we will want to flip this card over and add that card to the top of the discard pile. Besides this, we will return a boolean value indicating if we drew a new card or not. To do this, update the <code>drawCard</code> method to match the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>drawCard</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>card</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>card</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>flip</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>discardPile</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>card</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=shuffle-discard-pile-logic>Shuffle Discard Pile Logic</h3><p>For the <code>shuffleDiscardPile</code> method, we just need to call the <code>shuffleInDiscardPile</code> method on our <code>deck</code> instance. Besides this, we will also add a check to make sure that our draw card pile is empty, and then return a <code>boolean</code> value if we actually shuffled our cards. To do this, update the <code>shuffleDiscardPile</code> method to match the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>shuffleDiscardPile</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>drawPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>shuffleInDiscardPile</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=play-discard-cards>Play Discard Cards</h3><p>For playing our discard cards, there are two possible moves: the card was played to a foundation pile, or the card was played to a tableau pile. For both of these scenarios, we will want to validate if the card that was played is valid, and if so, then we add the <code>Card</code> instance to that location. For these changes, we will focus on the <code>playDiscardPileCardToFoundation</code> method first. When we play a card from the discard pile to the foundation pile, we will want do the following:</p><ul><li>First, get a reference to the top card in the discard pile. If there are no cards in the discard pile, we can return <code>false</code> since this is not a valid move.</li><li>Next, for the card that is being added, we will check the appropriate foundation pile and make sure this is the next card in the sequence. As an example, if I am trying to play the four of spades to the foundation pile, I will check the <code>#foundationPileSpade</code> property, and see if the current value is <code>3</code>. If the current value is not <code>3</code>, then we would return <code>false</code>.</li><li>If the move is valid, then we just need to call the <code>addCard</code> method on our <code>FoundationPile</code> instance, and then we can remove this card from the discard pile array.</li></ul><p>To do this logic, update the <code>playDiscardPileCardToFoundation</code> method to match the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>playDiscardPileCardToFoundation</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// get the top card of the discard pile (last element in array)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>card</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>discardPile</span>[<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>discardPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>card</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// based on the suit, check the correct foundation pile for the current value to make sure this is the next card
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>isValidMoveToAddCardToFoundation</span>(<span style=color:#a6e22e>card</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// play card to the foundation pile and remove from the discard pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>addCardToFoundation</span>(<span style=color:#a6e22e>card</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>discardPile</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Next, add the following code to the <code>Solitaire</code> class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>addCardToFoundation</span>(<span style=color:#a6e22e>card</span>: <span style=color:#66d9ef>Card</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>foundationPile</span>: <span style=color:#66d9ef>FoundationPile</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>suit</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CARD_SUIT.CLUB</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>foundationPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileClub</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CARD_SUIT.SPADE</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>foundationPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileSpade</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CARD_SUIT.HEART</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>foundationPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileHeart</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CARD_SUIT.DIAMOND</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>foundationPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileDiamond</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>exhaustiveGuard</span>(<span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>suit</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>foundationPile</span>.<span style=color:#a6e22e>addCard</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>isValidMoveToAddCardToFoundation</span>(<span style=color:#a6e22e>card</span>: <span style=color:#66d9ef>Card</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>foundationPile</span>: <span style=color:#66d9ef>FoundationPile</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>suit</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CARD_SUIT.CLUB</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>foundationPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileClub</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CARD_SUIT.SPADE</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>foundationPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileSpade</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CARD_SUIT.HEART</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>foundationPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileHeart</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CARD_SUIT.DIAMOND</span>:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>foundationPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileDiamond</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>exhaustiveGuard</span>(<span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>suit</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>foundationPile</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the code above, we used the <code>suit</code> of the card being played to select the appropriate foundation card pile, and we used a <code>switch</code> statement to do this. One thing to note is, in the <code>default</code> block of the <code>switch</code> statement, we are using the <code>exhaustiveGuard</code> function we created before to make sure we cover each type of <code>CARD_SUIT</code> we have defined. Right now, since we have covered each possible case, there are no warnings in our IDE related to our code. If we modified our code so we did not include each <code>CARD_SUIT</code> variation, like so:</p><p><img src=./images/solitaire-phaser-3-tutorial-5-1.png alt="Exhaustive guard function 1"></p><p>Then in our IDE, we would see a warning since we did not cover each possible value, like so:</p><p><img src=./images/solitaire-phaser-3-tutorial-5-2.png alt="Exhaustive guard function 2"></p><p>So now, for the <code>playDiscardPileCardToTableau</code> method, when we play a card from the discard pile to a tableau pile, we will need to do the following:</p><ul><li>First, get a reference to the top card in the discard pile. If there are no cards in the discard pile, we can return <code>false</code> since this is not a valid move.</li><li>Next, for the card that is being added, we will check the appropriate tableau pile and make sure this is a valid card in the sequence. As an example, if the tableau pile had a <code>5</code> of <code>diamonds</code> face up, I would be able to play either the <code>4</code> of <code>spades</code> or <code>4</code> of <code>clubs</code>. For the next card in the sequence, the card has to be the opposite color, and the next number when counting down. If a valid move is not made, we would return <code>false</code>.</li><li>If the move is valid, then we just need to push this card into the tableau array, for the pile we are adding the card to, and then we can remove this card from the discard pile array.</li><li>If the tableau pile is empty, then the only card that can be played is a king, and this can be any suit.</li></ul><p>To do this logic, update the <code>playDiscardPileCardToTableau</code> method to match the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>playDiscardPileCardToTableau</span>(<span style=color:#a6e22e>targetTableauIndex</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// get the top card of the discard pile (last element in array)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>card</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>discardPile</span>[<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>discardPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>card</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>targetTableauPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span>[<span style=color:#a6e22e>targetTableauIndex</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>targetTableauPile</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// based on the card suit color and card number, check that this card is allowed as the next card in the target tableau
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>isValidMoveToAddCardToTableau</span>(<span style=color:#a6e22e>card</span>, <span style=color:#a6e22e>targetTableauPile</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// play card to the tableau pile and remove from the discard pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span>[<span style=color:#a6e22e>targetTableauIndex</span>].<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>card</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>deck</span>.<span style=color:#a6e22e>discardPile</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Next, add the following code to the <code>Solitaire</code> class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>isValidMoveToAddCardToTableau</span>(<span style=color:#a6e22e>card</span>: <span style=color:#66d9ef>Card</span>, <span style=color:#a6e22e>tableauPile</span>: <span style=color:#66d9ef>Card</span>[])<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// if tableau is empty, only allow king (13) to be placed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>tableauPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>13</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// get reference to the last card in the tableau pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>lastTableauCard</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tableauPile</span>[<span style=color:#a6e22e>tableauPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// if last card in tableau is an ace (1), no cards can be added
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>lastTableauCard</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// validate next card in a tableau is the opposite color and next card in sequence, example red 8 -&gt; black 7
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>lastTableauCard</span>.<span style=color:#a6e22e>color</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>color</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>lastTableauCard</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the code above, to check if a card can be played to a tableau pile, the first thing we do is check if the pile is empty. If there are no cards, then the only card that can be played is a king, or a card with a value of <code>13</code>. If the pile is not empty, then we get a reference to the last card in the stack, and then make sure that the card we are adding is the opposite color, and the next number in sequence, counting down. Finally, we return <code>true</code>, if the move is valid.</p><h3 id=moving-tableau-cards>Moving Tableau Cards</h3><p>For moving the tableau cards around, there are two main things we can do: move one card from a tableau pile to a foundation pile, or move one or more cards from a tableau pile to another pile. For these changes, we will focus on the <code>moveTableauCardToFoundation</code> method first. When we play a card from a tableau pile to a foundation pile, we need to do the following steps:</p><ul><li>First, get a reference to the last card in the tableau pile. If there are no cards in the tableau pile, we can return <code>false</code> since this is not a valid move.</li><li>Next, for the card that is being added, we will check the appropriate foundation pile and make sure this is the next card in the sequence.</li><li>If the move is valid, then we just need to call the <code>addCard</code> method on our <code>FoundationPile</code> instance, and then we can remove this card from the tableau pile array.</li></ul><p>To do this logic, update the <code>playDiscardPileCardToFoundation</code> method to match the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>moveTableauCardToFoundation</span>(<span style=color:#a6e22e>tableauIndex</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// get the last card in the tableau pile that was provided (last element in the pile array)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tableauPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span>[<span style=color:#a6e22e>tableauIndex</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>tableauPile</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>card</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tableauPile</span>[<span style=color:#a6e22e>tableauPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>card</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// based on the card suit, check the correct foundation pile for the current value to make sure this is the next card
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>isValidMoveToAddCardToFoundation</span>(<span style=color:#a6e22e>card</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// play card to the foundation pile and remove from the tableau pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>addCardToFoundation</span>(<span style=color:#a6e22e>card</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tableauPile</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the code above, this is very similar to the logic in our <code>playDiscardPileCardToFoundation</code> method. The main difference is we are just adding a safeguard to make sure a valid <code>tableauIndex</code> was provided.</p><p>Next, for moving cards from one tableau pile to another, we need to do the following steps:</p><ul><li>For the provided tableau pile and card index, we need to make sure the provide card is currently face up (visible to the player). If the card is not visible, then we can return early.</li><li>Next, for the card that is being added, we will check the appropriate tableau pile and make sure this is a valid card in the sequence.</li><li>If the move is valid, than for each card that was part of the stack that was being moved, we need to add those cards to the new tableau pile array, and remove those cards from the previous tableau pile array.</li></ul><p>To do this logic, update the <code>moveTableauCardsToAnotherTableau</code> method to match the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>moveTableauCardsToAnotherTableau</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>initialTableauIndex</span>: <span style=color:#66d9ef>number</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cardIndex</span>: <span style=color:#66d9ef>number</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>targetTableauIndex</span>: <span style=color:#66d9ef>number</span>,
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>initialTableauPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span>[<span style=color:#a6e22e>initialTableauIndex</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>targetTableauPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span>[<span style=color:#a6e22e>targetTableauIndex</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>initialTableauPile</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>targetTableauPile</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// get the starting card from the first tableau pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>card</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>initialTableauPile</span>[<span style=color:#a6e22e>cardIndex</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>card</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// validate that the card is visible to the player
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>isFaceUp</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// based on the suit color and card number, check that this card is allowed as the next card in the target tableau
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>isValidMoveToAddCardToTableau</span>(<span style=color:#a6e22e>card</span>, <span style=color:#a6e22e>targetTableauPile</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// move the cards to the target tableau pile and remove from the initial tableau pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cardsToMove</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>initialTableauPile</span>.<span style=color:#a6e22e>splice</span>(<span style=color:#a6e22e>cardIndex</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cardsToMove</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>card</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>targetTableauPile</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>card</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the code above, this is similar to the logic we added in the <code>playDiscardPileCardToTableau</code> method. The main differences are that we added a few safeguards to make sure the provided tableau indexes and card index values are valid, and that the card is visible to the player. Lastly, since we can move a stack of cards, instead of a single card, we need to make sure we move each card to the correct tableau pile array.</p><h3 id=flip-tableau-card>Flip Tableau Card</h3><p>The last piece of logic we need to add to our <code>Solitaire</code> class, is the logic for the <code>flipTopTableauCard</code> method. In this method, we will be using this to check if we need to flip the last card in a tableau pile over, and we return a <code>boolean</code> value indicating if we flipped the card over or not. This will be used after we move the last visible card in a tableau pile to another tableau pile, or the foundation pile.</p><p>To do this logic, update the <code>flipTopTableauCard</code> method to match the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>flipTopTableauCard</span>(<span style=color:#a6e22e>tableauIndex</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// get the last card in the tableau pile that was provided (last element in the pile array)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tableauPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauPiles</span>[<span style=color:#a6e22e>tableauIndex</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>tableauPile</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>card</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tableauPile</span>[<span style=color:#a6e22e>tableauPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>card</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>isFaceUp</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>flip</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the code above, we added a few safeguards to make sure the provided tableau pile is valid, and we make sure the pile is not empty. We then grab a reference to the last card in the array and check to see if the card is already face up. If not, then we call the <code>flip</code> method on the <code>Card</code> instance.</p><p>With those last changes in place, we now have our core logic in place for our <code>Solitaire</code> class, and we should be able to play a full game of Solitaire using this class.</p><h2 id=update-game-scene>Update Game Scene</h2><p>Now that we have the core logic for <code>Solitaire</code> ready to go, we need to update our Phaser game instance to use this logic, and to have the game objects match the state in our <code>solitaire</code> game instance. To get started with the changes, we will first start with our <code>#createDrawPile</code> method.</p><h3 id=update-create-draw-pile-logic>Update Create Draw Pile Logic</h3><p>Currently, in the event listener for the <code>pointerdown</code> event, we are just updating the frames on our discard pile to match our card back frame. Instead, we will now want do the following logic when we attempt to draw a card:</p><ul><li>First, add a safeguard for if we have no cards in either the draw or discard piles, then we don&rsquo;t need to do anything with the click event. Eventually, we can get to this state after moving all cards from the discard pile to the tableau or foundation piles.</li><li>Next, if our draw pile is empty, then we need to add the cards from the discard pile back into our draw pile, and update the discard pile cards to not be visible.</li><li>Lastly, if we draw a new card, then we need to update the card in our discard pile to match the card that drawn from the draw pile.</li></ul><p>To make these changes, in the <code>#createDrawPile</code> method of our <code>GameScene</code> class in the <code>src/scenes/game-scene.ts</code> file, replace the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>drawZone</span>.<span style=color:#a6e22e>on</span>(<span style=color:#a6e22e>Phaser</span>.<span style=color:#a6e22e>Input</span>.<span style=color:#a6e22e>Events</span>.<span style=color:#a6e22e>POINTER_DOWN</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// update the bottom card in the discard pile to reflect the top card
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>setFrame</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>frame</span>).<span style=color:#a6e22e>setVisible</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>visible</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// update the top card in the discard pile to reflect card we drew
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>setFrame</span>(<span style=color:#a6e22e>CARD_BACK_FRAME</span>).<span style=color:#a6e22e>setVisible</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>drawZone</span>.<span style=color:#a6e22e>on</span>(<span style=color:#a6e22e>Phaser</span>.<span style=color:#a6e22e>Input</span>.<span style=color:#a6e22e>Events</span>.<span style=color:#a6e22e>POINTER_DOWN</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// if no cards in either pile, we don&#39;t need to do anything in the ui
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>drawPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>discardPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// if no cards in draw pile, we need to shuffle in discard pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>drawPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// shuffle in discard pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>shuffleDiscardPile</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// show no cards in discard pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>card</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>setVisible</span>(<span style=color:#66d9ef>false</span>));
</span></span><span style=display:flex><span>    <span style=color:#75715e>// show cards in draw pile based on number of cards in pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>showCardsInDrawPile</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// reaching here means we have cards in the draw pile, so we need to draw a card
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>drawCard</span>();
</span></span><span style=display:flex><span>  <span style=color:#75715e>// update the shown cards in the draw pile to be based on number of cards in pile
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>showCardsInDrawPile</span>();
</span></span><span style=display:flex><span>  <span style=color:#75715e>// update the bottom card in the discard pile to reflect the top card
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>setFrame</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>frame</span>).<span style=color:#a6e22e>setVisible</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>visible</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// update the top card in the discard pile to reflect card we drew
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>card</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>discardPile</span>[<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>discardPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>setFrame</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>getCardFrame</span>(<span style=color:#a6e22e>card</span>)).<span style=color:#a6e22e>setVisible</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>In the code above, we referenced a few private methods that do not exist in our code yet, so we will need to add these methods now. In the <code>GameScene</code> class, add the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>showCardsInDrawPile</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>numberOfCardsToShow</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>min</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>drawPile</span>.<span style=color:#a6e22e>length</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>drawPileCards</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>card</span>, <span style=color:#a6e22e>cardIndex</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>showCard</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cardIndex</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>numberOfCardsToShow</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>setVisible</span>(<span style=color:#a6e22e>showCard</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>getCardFrame</span>(<span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>Card</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>FoundationPile</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>number</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>SUIT_FRAMES</span>[<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>suit</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>and at the top of the file, add the following <code>import</code> statements:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Card</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../lib/card&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>FoundationPile</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../lib/foundation-pile&#39;</span>;
</span></span></code></pre></div><p>In the <code>#showCardsInDrawPile</code> method, we added logic to modify the number of cards that we are displaying in the draw pile. With this change, once we get down to two or one cards in the draw pile, the draw pile in our Scene will only show that number of cards. In the <code>#getCardFrame</code> method, we are using the <code>SUIT_FRAMES</code> variable to figure out what is the frame we need to use for the card we are showing to the player. In our spritesheet, the cards are organized by card suit, and they are ordered in sequential order, and so we can use the starting frame combined with the card value we want to show to find the correct frame. Besides these changes, the rest of the code implements the logic we outlined above and calls the appropriate methods on our <code>Solitaire</code> class instance.</p><p>If you save your code changes and view the game in the browser, if you click on the draw pile, you should see the cards start to appear in the discard pile. If we cycle through the draw card pile, you should see that the draw pile updates to only show 1 or 2 cards once we start to run of cards, and finally once the pile is empty, the discard pile should be added back to the draw pile.</p><p><img src=./images/solitaire-phaser-3-tutorial-4-3.gif alt="Updated draw pile"></p><h3 id=update-create-tableau-pile-logic>Update Create Tableau Pile Logic</h3><p>Currently, in the <code>#createTableauPiles</code> method, we are manually creating each of our Card Image game objects, and we are setting each frame of the Image game objects to be the card back frame, and we are making each card enabled to be draggable. Instead, we will want to update this method to use the <code>tableauPiles</code> property on our <code>Solitaire</code> game instance, and then update each Card Image game object to have the correct frame based on the actual game state. Finally, we will only want cards that are face up to be draggable. To make these changes, we will replace all of the code in the <code>#createTableauPiles</code> method with the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauContainers</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>tableauPiles</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>pile</span>, <span style=color:#a6e22e>pileIndex</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>TABLEAU_PILE_X_POSITION</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>pileIndex</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>85</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tableauContainer</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>add</span>.<span style=color:#a6e22e>container</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>TABLEAU_PILE_Y_POSITION</span>, []);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauContainers</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>tableauContainer</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pile</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>card</span>, <span style=color:#a6e22e>cardIndex</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cardGameObject</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>createCard</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>cardIndex</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>20</span>, <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>cardIndex</span>, <span style=color:#a6e22e>pileIndex</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tableauContainer</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>cardGameObject</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>isFaceUp</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>cardGameObject</span>.<span style=color:#a6e22e>setFrame</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>getCardFrame</span>(<span style=color:#a6e22e>card</span>));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>setDraggable</span>(<span style=color:#a6e22e>cardGameObject</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>If you save your code changes and view the game in the browser, you should see that the last card in each tableau pile is now face up, and if you try to move the face up cards, you can drag them, but if you try to drag face down cards, they will not be movable.</p><p><img src=./images/solitaire-phaser-3-tutorial-5-4.gif alt="Updated tableau piles"></p><h3 id=more-game-scene-updates>More Game Scene Updates</h3><p>For our next change, we have a <code>TODO</code> in the <code>#updateCardGameObjectsInDiscardPile</code> method that we need to address. In this method, we need to add logic to update bottom card Image game object to have the correct state based on the game state in the <code>Solitaire</code> game instance. To do this, replace the logic in the <code>#updateCardGameObjectsInDiscardPile</code> method with the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// update the top card in the discard pile to reflect the card below it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>setFrame</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>frame</span>).<span style=color:#a6e22e>setVisible</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>visible</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// update the bottom card in the discard pile to have the correct value based on the solitaire game state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>discardPileCard</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>discardPile</span>[<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>discardPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>discardPileCard</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>setVisible</span>(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>discardPileCards</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>setFrame</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>getCardFrame</span>(<span style=color:#a6e22e>discardPileCard</span>)).<span style=color:#a6e22e>setVisible</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the code above, we grab the 2nd to last card from the <code>discardPile</code> in our <code>Solitaire</code> game state. If there is no card, we update the bottom discard pile Card Image game object to not be visible, and if a card is found, we then update the <code>frame</code> to show the correct card texture.</p><p>If you save your code changes and view the game in the browser, if we fill up the cards in the discard pile and play cards from the discard pile, you should see that the bottom card is updated to have the correct card image.</p><p><img src=./images/solitaire-phaser-3-tutorial-5-5.gif alt="Updated discard piles"></p><p>Next, we need to update the <code>#updateFoundationPiles</code> method to update each of the Card Image game objects that represent our foundation piles to have the correct <code>frame</code> based on the state in our <code>Solitaire</code> game instance. To do this, replace the logic in the <code>#updateFoundationPiles</code> method with the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>foundationPiles</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>pile</span>: <span style=color:#66d9ef>FoundationPile</span>, <span style=color:#a6e22e>pileIndex</span>: <span style=color:#66d9ef>number</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>pile</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>foundationPileCards</span>[<span style=color:#a6e22e>pileIndex</span>].<span style=color:#a6e22e>setVisible</span>(<span style=color:#66d9ef>true</span>).<span style=color:#a6e22e>setFrame</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>getCardFrame</span>(<span style=color:#a6e22e>pile</span>));
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>In the code above, we are looping through each of the foundation piles in our <code>Solitaire</code> game instance, and as long as the <code>value</code> on the pile is not <code>0</code>, which means the pile is empty, we then update the Card Image game object to be visible and to have the correct <code>frame</code>.</p><p>If you save your code changes and view the game in the browser, if you add a valid card to the foundation pile, you should see that the texture on the foundation pile is updated.</p><p><img src=./images/solitaire-phaser-3-tutorial-5-6.gif alt="Updated foundation piles"></p><p>Finally, one last change we need to make is we need to add the logic to the <code>#handleRevealingNewTableauCards</code> method. In this method, we need to update the <code>depth</code> on our tableau container game object to be <code>0</code>, that way our depth is reset properly. Then, we need to check and see if we need to flip over the next card in the tableau pile that a card was just moved from. To do this check, we will call the <code>flipTopTableauCard</code> method on our <code>Solitaire</code> class, and if a card is flipped over, then we update the relevant Card Image game object to have the correct texture and update that game object to be draggable. To make these code changes, replace the code in the <code>#handleRevealingNewTableauCards</code> method with the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// update tableau container depth
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauContainers</span>[<span style=color:#a6e22e>tableauPileIndex</span>].<span style=color:#a6e22e>setDepth</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// check to see if the tableau pile card at the bottom of the sack needs to be flipped over
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>flipTableauCard</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>flipTopTableauCard</span>(<span style=color:#a6e22e>tableauPileIndex</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>flipTableauCard</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tableauPile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>solitaire</span>.<span style=color:#a6e22e>tableauPiles</span>[<span style=color:#a6e22e>tableauPileIndex</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tableauCard</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tableauPile</span>[<span style=color:#a6e22e>tableauPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cardGameObject</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>tableauContainers</span>[<span style=color:#a6e22e>tableauPileIndex</span>].<span style=color:#a6e22e>getAt</span>&lt;<span style=color:#f92672>Phaser.GameObjects.Image</span>&gt;(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tableauPile</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cardGameObject</span>.<span style=color:#a6e22e>setFrame</span>(<span style=color:#66d9ef>this</span>.<span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>getCardFrame</span>(<span style=color:#a6e22e>tableauCard</span>));
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>setDraggable</span>(<span style=color:#a6e22e>cardGameObject</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>If you save your code changes and view the game in the browser, if you move a card from the tableau pile to another pile, which results in the last card in that stack not being flipped over, the game logic should now flip that card.</p><p><img src=./images/solitaire-phaser-3-tutorial-5-7.gif alt="Update tableau pile to flip cards"></p><p>With those last changes, we have now completed our Solitaire game, and you should be able to play a whole game!</p><h2 id=summary>Summary</h2><p>All right, with those last changes that brings an end to this part of the tutorial. In this part of the tutorial, we added in the core logic for our Solitaire game and we connected this logic to our Phaser game instance.</p><p>You can find the completed source code for this article here on GitHub:
<a href=https://github.com/devshareacademy/phaser-3-solitaire-tutorial/tree/solitaire_core target=_blank rel=noopener>Part 5 Source Code</a></p><p>If you run into any issues, please reach out via
<a href=https://github.com/devshareacademy/phaser-3-solitaire-tutorial/discussions target=_blank rel=noopener>GitHub Discussions</a>
, or leave a comment down below.</p><p>In
<a href=/post/2024/08/solitaire-phaser-3-tutorial-6/>part 6</a>
of this series, we will wrap up our game by adding in a new Title Scene with a nice scene transition.</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/html5/ rel=tag>HTML5</a></li><li class=tags__item><a class="tags__link btn" href=/tags/game-development/ rel=tag>Game Development</a></li><li class=tags__item><a class="tags__link btn" href=/tags/typescript/ rel=tag>TypeScript</a></li><li class=tags__item><a class="tags__link btn" href=/tags/tutorial/ rel=tag>Tutorial</a></li><li class=tags__item><a class="tags__link btn" href=/tags/solitaire/ rel=tag>Solitaire</a></li><li class=tags__item><a class="tags__link btn" href=/tags/phaserjs/ rel=tag>PhaserJS</a></li><li class=tags__item><a class="tags__link btn" href=/tags/phaser3/ rel=tag>Phaser3</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="Scott Westover avatar" src=https://secure.gravatar.com/avatar/d5b6863a31baa2c531949202b1de9c82 class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>About Scott Westover</span></div><div class=authorbox__description>Scott Westover is a Software Developer who loves coding, writing tutorials, participating in game jams, and learning about new technologies. When he is not coding, he is either spending time with his wife and two kids or is reading a great book. Scott is looking to form connections and share his knowledge.</div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/post/2024/08/solitaire-phaser-3-tutorial-4/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>Solitaire HTML5 Game Tutorial With Phaser 3 Part 4: Moving Cards</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/post/2024/08/solitaire-phaser-3-tutorial-6/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>Solitaire HTML5 Game Tutorial With Phaser 3 Part 6: Title Scene</p></a></div></nav><section class=comments><div id=gitment-comments></div></section><script src=https://utteranc.es/client.js repo=scottwestover/scottwestover.dev issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2024 Scott Westover.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>